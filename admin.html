<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amar Kajer Hisab - Admin Panel (No Auth)</title>
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #f0f2f5; }
        
        .admin-panel {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: white;
            cursor: pointer;
            font-weight: bold;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        th {
            background: #f8f9fa;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #5a67d8;
        }
        
        .success { background: #10b981; }
        .danger { background: #ef4444; }
        .warning { background: #f59e0b; }
    </style>
</head>
<body>
    <div class="admin-panel">
        <div class="header">
            <h1>üìä ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ - ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h1>
            <p>‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ - ‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡¶ó‡¶á‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á</p>
            <p style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó: <span id="connectionStatus">‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶õ‡¶ø...</span>
            </p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
            <button class="tab" onclick="showTab('dataEntry')">‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</button>
            <button class="tab" onclick="showTab('profile')">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</button>
            <button class="tab" onclick="showTab('history')">‡¶™‡ßÅ‡¶∞‡ßã ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>üìà ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂</h2>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px;">
                    <h3 id="totalAmount">‡ß≥0</h3>
                    <p>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</p>
                </div>
                <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px; border-radius: 10px;">
                    <h3 id="totalPieces">0</h3>
                    <p>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</p>
                </div>
                <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 20px; border-radius: 10px;">
                    <h3 id="totalDays">0</h3>
                    <p>‡¶Æ‡ßã‡¶ü ‡¶¶‡¶ø‡¶®</p>
                </div>
                <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 20px; border-radius: 10px;">
                    <h3 id="lastUpdate">---</h3>
                    <p>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</p>
                </div>
            </div>
            
            <h3>‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
            <div id="recentEntries"></div>
        </div>
        
        <!-- Data Entry Tab -->
        <div id="dataEntry" class="tab-content">
            <h2>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <input type="date" id="entryDate" style="margin-bottom: 15px;">
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div>
                        <label>‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ú‡¶æ‡¶¨‡¶ø (‡ß≥7)</label>
                        <input type="number" id="panjabi" value="0" min="0">
                    </div>
                    <div>
                        <label>‡¶∂‡¶æ‡¶∞‡ßç‡¶ü (‡ß≥5)</label>
                        <input type="number" id="shirt" value="0" min="0">
                    </div>
                    <div>
                        <label>34-38 ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ú‡¶æ‡¶¨‡¶ø (‡ß≥5)</label>
                        <input type="number" id="panjabi_34_38" value="0" min="0">
                    </div>
                    <div>
                        <label>20-30 ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ú‡¶æ‡¶¨‡¶ø (‡ß≥3.50)</label>
                        <input type="number" id="panjabi_20_30" value="0" min="0">
                    </div>
                    <div>
                        <label>14-18 ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ú‡¶æ‡¶¨‡¶ø (‡ß≥3)</label>
                        <input type="number" id="panjabi_14_18" value="0" min="0">
                    </div>
                    <div>
                        <label>‡¶°‡ßç‡¶∞‡¶ú‡¶æ‡¶∞ (‡ß≥3)</label>
                        <input type="number" id="drawjar" value="0" min="0">
                    </div>
                </div>
                
                <label style="margin-top: 15px; display: block;">‡¶®‡ßã‡¶ü‡¶∏</label>
                <textarea id="entryNotes" rows="3"></textarea>
                
                <button onclick="saveEntry()" class="success" style="margin-top: 20px;">üíæ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button onclick="resetEntryForm()" class="warning">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
            </div>
            
            <h2>üìù ‡¶∏‡¶¨ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h2>
            <div id="allEntries"></div>
        </div>
        
        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <h2>üë§ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <input type="text" id="profileName" placeholder="‡¶®‡¶æ‡¶Æ" style="margin-bottom: 10px;">
                <input type="text" id="profileSkills" placeholder="‡¶¶‡¶ï‡ßç‡¶∑‡¶§‡¶æ (‡¶ï‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá)" style="margin-bottom: 10px;">
                <input type="text" id="profileContact" placeholder="‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó" style="margin-bottom: 10px;">
                <textarea id="profileBio" placeholder="‡¶¨‡¶æ‡¶Ø‡¶º‡ßã/‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§" rows="4" style="margin-bottom: 15px;"></textarea>
                
                <button onclick="saveProfile()" class="success">üíæ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠</button>
                <button onclick="loadProfile()" class="warning">üîÑ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶°</button>
            </div>
        </div>
        
        <!-- History Tab -->
        <div id="history" class="tab-content">
            <h2>üìã ‡¶™‡ßÅ‡¶∞‡ßã ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h2>
            <div style="margin-bottom: 20px;">
                <button onclick="downloadCSV()" class="success">üì• CSV ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                <button onclick="loadHistory()" class="warning">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button>
            </div>
            <div id="historyTable"></div>
        </div>
    </div>

    <script>
        // ====================== SUPABASE CONFIGURATION ======================
        const SUPABASE_URL = 'https://qsvuzobizalcgqnlxuqv.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_mbhqaW7EzLccLp3gNjNy1g_ncCb4uvN';
        // ====================================================================
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            checkConnection();
            loadAllData();
        });
        
        // Check Connection
        async function checkConnection() {
            try {
                const { data, error } = await supabase.from('entries').select('count');
                document.getElementById('connectionStatus').textContent = 
                    error ? '‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‚ùå' : '‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‚úÖ';
                document.getElementById('connectionStatus').style.color = 
                    error ? '#ef4444' : '#10b981';
            } catch (err) {
                document.getElementById('connectionStatus').textContent = '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‚ùå';
                document.getElementById('connectionStatus').style.color = '#ef4444';
            }
        }
        
        // Show Tab
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // Load All Data
        async function loadAllData() {
            try {
                // Load entries
                const { data: entries } = await supabase
                    .from('entries')
                    .select('*')
                    .order('date', { ascending: false });
                
                if (entries) {
                    // Calculate totals
                    const totalAmount = entries.reduce((sum, e) => sum + (e.total_amount || 0), 0);
                    const totalPieces = entries.reduce((sum, e) => sum + (e.total_pieces || 0), 0);
                    
                    // Update dashboard
                    document.getElementById('totalAmount').textContent = `‡ß≥${totalAmount.toLocaleString()}`;
                    document.getElementById('totalPieces').textContent = totalPieces.toLocaleString();
                    document.getElementById('totalDays').textContent = entries.length;
                    
                    if (entries.length > 0) {
                        const lastDate = new Date(entries[0].date);
                        document.getElementById('lastUpdate').textContent = 
                            lastDate.toLocaleDateString('bn-BD');
                    }
                    
                    // Update recent entries
                    let recentHtml = '<table>';
                    recentHtml += '<tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ú‡¶æ‡¶¨‡¶ø</th><th>‡¶∂‡¶æ‡¶∞‡ßç‡¶ü</th><th>‡¶°‡ßç‡¶∞‡¶ú‡¶æ‡¶∞</th><th>‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr>';
                    
                    entries.slice(0, 5).forEach(entry => {
                        const date = new Date(entry.date);
                        recentHtml += `
                            <tr>
                                <td>${date.toLocaleDateString('bn-BD')}</td>
                                <td>${entry.panjabi || 0}</td>
                                <td>${entry.shirt || 0}</td>
                                <td>${entry.drawjar || 0}</td>
                                <td>${entry.total_pieces || 0}</td>
                                <td>‡ß≥${(entry.total_amount || 0).toLocaleString()}</td>
                                <td>
                                    <button onclick="editEntry('${entry.date}')" style="padding: 5px 10px;">‚úèÔ∏è</button>
                                    <button onclick="deleteEntry('${entry.date}')" style="padding: 5px 10px; background: #ef4444;">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    recentHtml += '</table>';
                    document.getElementById('recentEntries').innerHTML = recentHtml;
                    
                    // Update all entries
                    let allHtml = '<table>';
                    allHtml += '<tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ú‡¶æ‡¶¨‡¶ø</th><th>‡¶∂‡¶æ‡¶∞‡ßç‡¶ü</th><th>34-38</th><th>20-30</th><th>14-18</th><th>‡¶°‡ßç‡¶∞‡¶ú‡¶æ‡¶∞</th><th>‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr>';
                    
                    entries.forEach(entry => {
                        const date = new Date(entry.date);
                        allHtml += `
                            <tr>
                                <td>${date.toLocaleDateString('bn-BD')}</td>
                                <td>${entry.panjabi || 0}</td>
                                <td>${entry.shirt || 0}</td>
                                <td>${entry.panjabi_34_38 || 0}</td>
                                <td>${entry.panjabi_20_30 || 0}</td>
                                <td>${entry.panjabi_14_18 || 0}</td>
                                <td>${entry.drawjar || 0}</td>
                                <td>${entry.total_pieces || 0}</td>
                                <td>‡ß≥${(entry.total_amount || 0).toLocaleString()}</td>
                                <td>
                                    <button onclick="editEntry('${entry.date}')" style="padding: 5px 10px;">‚úèÔ∏è</button>
                                    <button onclick="deleteEntry('${entry.date}')" style="padding: 5px 10px; background: #ef4444;">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    allHtml += '</table>';
                    document.getElementById('allEntries').innerHTML = allHtml;
                }
                
            } catch (error) {
                alert('‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + error.message);
            }
        }
        
        // Save Entry
        async function saveEntry() {
            const date = document.getElementById('entryDate').value;
            const panjabi = parseInt(document.getElementById('panjabi').value) || 0;
            const shirt = parseInt(document.getElementById('shirt').value) || 0;
            const panjabi_34_38 = parseInt(document.getElementById('panjabi_34_38').value) || 0;
            const panjabi_20_30 = parseInt(document.getElementById('panjabi_20_30').value) || 0;
            const panjabi_14_18 = parseInt(document.getElementById('panjabi_14_18').value) || 0;
            const drawjar = parseInt(document.getElementById('drawjar').value) || 0;
            const notes = document.getElementById('entryNotes').value;
            
            const total_pieces = panjabi + shirt + panjabi_34_38 + panjabi_20_30 + panjabi_14_18 + drawjar;
            const total_amount = (panjabi * 7) + (shirt * 5) + (panjabi_34_38 * 5) + 
                                (panjabi_20_30 * 3.5) + (panjabi_14_18 * 3) + (drawjar * 3);
            
            const entry = {
                date,
                panjabi,
                shirt,
                panjabi_34_38,
                panjabi_20_30,
                panjabi_14_18,
                drawjar,
                total_pieces,
                total_amount,
                notes
            };
            
            try {
                // Check if exists
                const { data: existing } = await supabase
                    .from('entries')
                    .select('*')
                    .eq('date', date)
                    .single();
                
                if (existing) {
                    await supabase.from('entries').update(entry).eq('date', date);
                    alert('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                } else {
                    await supabase.from('entries').insert([entry]);
                    alert('‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
                
                resetEntryForm();
                loadAllData();
                
            } catch (error) {
                alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
            }
        }
        
        // Edit Entry
        async function editEntry(date) {
            try {
                const { data: entry } = await supabase
                    .from('entries')
                    .select('*')
                    .eq('date', date)
                    .single();
                
                if (entry) {
                    document.getElementById('entryDate').value = entry.date;
                    document.getElementById('panjabi').value = entry.panjabi || 0;
                    document.getElementById('shirt').value = entry.shirt || 0;
                    document.getElementById('panjabi_34_38').value = entry.panjabi_34_38 || 0;
                    document.getElementById('panjabi_20_30').value = entry.panjabi_20_30 || 0;
                    document.getElementById('panjabi_14_18').value = entry.panjabi_14_18 || 0;
                    document.getElementById('drawjar').value = entry.drawjar || 0;
                    document.getElementById('entryNotes').value = entry.notes || '';
                    
                    showTab('dataEntry');
                    alert('‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶°: ' + new Date(date).toLocaleDateString('bn-BD'));
                }
            } catch (error) {
                alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
            }
        }
        
        // Delete Entry
        async function deleteEntry(date) {
            if (confirm(`"${new Date(date).toLocaleDateString('bn-BD')}" ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?`)) {
                try {
                    await supabase.from('entries').delete().eq('date', date);
                    alert('‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                    loadAllData();
                } catch (error) {
                    alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
                }
            }
        }
        
        // Reset Entry Form
        function resetEntryForm() {
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('panjabi').value = 0;
            document.getElementById('shirt').value = 0;
            document.getElementById('panjabi_34_38').value = 0;
            document.getElementById('panjabi_20_30').value = 0;
            document.getElementById('panjabi_14_18').value = 0;
            document.getElementById('drawjar').value = 0;
            document.getElementById('entryNotes').value = '';
        }
        
        // Save Profile
        async function saveProfile() {
            const profile = {
                name: document.getElementById('profileName').value,
                skills: document.getElementById('profileSkills').value,
                contact: document.getElementById('profileContact').value,
                bio: document.getElementById('profileBio').value,
                updated_at: new Date().toISOString()
            };
            
            try {
                await supabase.from('profile').upsert(profile);
                alert('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            } catch (error) {
                alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
            }
        }
        
        // Load Profile
        async function loadProfile() {
            try {
                const { data: profile } = await supabase
                    .from('profile')
                    .select('*')
                    .limit(1)
                    .single();
                
                if (profile) {
                    document.getElementById('profileName').value = profile.name || '';
                    document.getElementById('profileSkills').value = profile.skills || '';
                    document.getElementById('profileContact').value = profile.contact || '';
                    document.getElementById('profileBio').value = profile.bio || '';
                    alert('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                } else {
                    alert('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø');
                }
            } catch (error) {
                alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
            }
        }
        
        // Load History
        async function loadHistory() {
            try {
                const { data: entries } = await supabase
                    .from('entries')
                    .select('*')
                    .order('date', { ascending: false });
                
                if (entries && entries.length > 0) {
                    let html = '<table>';
                    html += '<tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ú‡¶æ‡¶¨‡¶ø</th><th>‡¶∂‡¶æ‡¶∞‡ßç‡¶ü</th><th>34-38</th><th>20-30</th><th>14-18</th><th>‡¶°‡ßç‡¶∞‡¶ú‡¶æ‡¶∞</th><th>‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</th><th>‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th></tr>';
                    
                    entries.forEach(entry => {
                        const date = new Date(entry.date);
                        html += `
                            <tr>
                                <td>${date.toLocaleDateString('bn-BD')}</td>
                                <td>${entry.panjabi || 0}</td>
                                <td>${entry.shirt || 0}</td>
                                <td>${entry.panjabi_34_38 || 0}</td>
                                <td>${entry.panjabi_20_30 || 0}</td>
                                <td>${entry.panjabi_14_18 || 0}</td>
                                <td>${entry.drawjar || 0}</td>
                                <td>${entry.total_pieces || 0}</td>
                                <td>‡ß≥${(entry.total_amount || 0).toLocaleString()}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</table>';
                    document.getElementById('historyTable').innerHTML = html;
                } else {
                    document.getElementById('historyTable').innerHTML = '<p>‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</p>';
                }
            } catch (error) {
                alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
            }
        }
        
        // Download CSV
        function downloadCSV() {
            const table = document.querySelector('#historyTable table');
            if (!table) {
                alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }
            
            let csv = [];
            const rows = table.querySelectorAll('tr');
            
            rows.forEach(row => {
                const rowData = [];
                row.querySelectorAll('th, td').forEach(cell => {
                    rowData.push(cell.textContent);
                });
                csv.push(rowData.join(','));
            });
            
            const csvString = csv.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'amar-kajer-hisab.csv';
            link.click();
        }
    </script>
</body>
</html>