<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amar Kajer Hisab by OP Aminul FF</title>
    <meta name="description" content="‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® ‡¶∏‡¶π‡¶ú‡ßá - ‡¶≤‡¶®‡ßç‡¶°‡ßç‡¶∞‡¶ø ‡¶Ü‡¶Ø‡¶º‡¶∞‡¶® ‡¶™‡ßã‡¶∂‡¶æ‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡•§ OP Aminul FF">
    <meta name="keywords" content="amar kajer hishab, op aminul ff, hisab app, laundry tracker">
    
    <!-- Firebase CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.14.1/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.14.1/firebase-database-compat.min.js"></script>
    
    <style>
        /* CSS Variables for Theme */
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #7c3aed;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #f8fafc;
            --card-color: #ffffff;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --gradient: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --bg-color: #0f172a;
            --card-color: #1e293b;
            --text-color: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            --gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--gradient);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .app-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Navigation Tabs */
        .tabs {
            display: flex;
            background-color: var(--card-color);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 15px 20px;
            background-color: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px;
        }

        .tab:hover {
            background-color: rgba(79, 70, 229, 0.1);
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            background-color: rgba(79, 70, 229, 0.1);
            border-bottom: 3px solid var(--primary-color);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background-color: var(--card-color);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            text-align: center;
            padding: 25px 20px;
            border-radius: var(--radius);
            background: var(--gradient);
            color: white;
            box-shadow: var(--shadow);
        }

        .stat-card.secondary {
            background: linear-gradient(135deg, var(--success-color) 0%, #34d399 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #fbbf24 100%);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Progress Bar */
        .progress-container {
            margin: 30px 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 20px;
            background-color: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: rgba(79, 70, 229, 0.1);
            color: var(--primary-color);
            font-weight: 700;
        }

        tr:hover {
            background-color: rgba(79, 70, 229, 0.05);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
            font-size: 1rem;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background-color: var(--text-secondary);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* Profile */
        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid var(--primary-color);
            margin-bottom: 20px;
        }

        .profile-name {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            margin-top: 30px;
        }

        .detail-item {
            text-align: left;
            padding: 15px;
            background-color: rgba(79, 70, 229, 0.05);
            border-radius: var(--radius);
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 4px solid rgba(79, 70, 229, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
            
            .filter-section {
                flex-direction: column;
            }
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
        }

        .footer-text {
            font-size: 0.9rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: var(--success-color);
            color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.5s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: var(--danger-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div>
                    <h1 class="app-title">üìä Amar Kajer Hisab by OP Aminul FF</h1>
                    <p class="app-subtitle">‡¶≤‡¶®‡ßç‡¶°‡ßç‡¶∞‡¶ø/‡¶Ü‡¶Ø‡¶º‡¶∞‡¶®/‡¶™‡ßã‡¶∂‡¶æ‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ | ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç</p>
                </div>
                <button class="theme-toggle" id="themeToggle">
                    üåô
                </button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="dashboard">üè† ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
            <button class="tab" data-tab="last7days">üìÖ ‡¶∂‡ßá‡¶∑ ‡ß≠ ‡¶¶‡¶ø‡¶®</button>
            <button class="tab" data-tab="fullHistory">üìã ‡¶™‡ßÅ‡¶∞‡ßã ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</button>
            <button class="tab" data-tab="profile">üë§ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</button>
            <button class="tab" data-tab="feedback">üí¨ ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§/‡¶Ö‡¶´‡¶æ‡¶∞</button>
            <button class="tab" data-tab="payments">üí∞ ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶™‡¶æ‡¶ì‡¶®‡¶æ</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value" id="totalAmount">0</div>
                    <div class="stat-label">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</div>
                </div>
                <div class="stat-card secondary">
                    <div class="stat-icon">üëï</div>
                    <div class="stat-value" id="totalPieces">0</div>
                    <div class="stat-label">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-value" id="avgPerDay">0</div>
                    <div class="stat-label">‡¶ó‡¶°‡¶º ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶¶‡¶ø‡¶®</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-value" id="lastUpdate">---</div>
                    <div class="stat-label">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">üî• ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏</h2>
                <div class="progress-container">
                    <div class="progress-header">
                        <span>‡¶ó‡¶§‡¶ï‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú: <strong id="lastDayPieces">0</strong> ‡¶™‡¶ø‡¶∏</span>
                        <span>‡¶ó‡¶°‡¶º: <strong id="avgPerHour">0</strong> ‡¶™‡¶ø‡¶∏/‡¶ò‡¶£‡ßç‡¶ü‡¶æ</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="liveProgressBar" style="width: 0%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 1.2rem;">
                        <span id="liveCounter">0</span> / <span id="lastDayTotal">0</span> ‡¶™‡¶ø‡¶∏
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">üìä ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∞‡ßá‡¶ü</h2>
                <table>
                    <thead>
                        <tr>
                            <th>‡¶™‡¶£‡ßç‡¶Ø</th>
                            <th>‡¶¶‡¶∞ (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶™‡¶ø‡¶∏)</th>
                            <th>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</th>
                            <th>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable">
                        <!-- Product data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Last 7 Days Tab -->
        <div id="last7days" class="tab-content">
            <div class="card">
                <h2 class="card-title">üìÖ ‡¶∂‡ßá‡¶∑ ‡ß≠ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h2>
                <div id="last7daysTableContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Full History Tab -->
        <div id="fullHistory" class="tab-content">
            <div class="card">
                <h2 class="card-title">üìã ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶ú ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h2>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <label for="fromDate">‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="fromDate">
                    </div>
                    <div class="filter-group">
                        <label for="toDate">‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="toDate">
                    </div>
                    <div class="filter-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-success" id="applyFilter">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó</button>
                    </div>
                </div>

                <div style="margin: 20px 0; display: flex; gap: 10px;">
                    <button class="btn" id="downloadCSV">üì• CSV ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                    <button class="btn btn-secondary" id="resetFilter">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                </div>

                <div id="fullHistoryTableContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>‡¶™‡ßÅ‡¶∞‡ßã ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <div class="card">
                <h2 class="card-title">üë§ ‡¶ï‡¶∞‡ßç‡¶Æ‡ßÄ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ - OP Aminul FF</h2>
                
                <div class="profile-section">
                    <img src="https://via.placeholder.com/150/4f46e5/ffffff?text=OP+Aminul+FF" alt="Profile" class="profile-image" id="profileImage">
                    <h2 class="profile-name" id="profileName">OP Aminul FF</h2>
                    <p id="profileCurrentCompany">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®: ‡¶≤‡¶®‡ßç‡¶°‡ßç‡¶∞‡¶ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</p>
                </div>

                <div class="profile-details">
                    <div class="detail-item">
                        <h3>üõ†Ô∏è ‡¶¶‡¶ï‡ßç‡¶∑‡¶§‡¶æ</h3>
                        <p id="profileSkills">‡¶≤‡¶®‡ßç‡¶°‡ßç‡¶∞‡¶ø, ‡¶Ü‡¶Ø‡¶º‡¶∞‡¶®, ‡¶™‡ßã‡¶∂‡¶æ‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç, ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</p>
                    </div>
                    <div class="detail-item">
                        <h3>üìù ‡¶ö‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§</h3>
                        <p id="profileAgreement">‡¶ö‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶∞ ‡¶¶‡¶ø‡¶®: <span id="agreementDays">30</span> ‡¶¶‡¶ø‡¶®</p>
                    </div>
                    <div class="detail-item">
                        <h3>üìû ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</h3>
                        <p id="profileContact">‡¶á‡¶Æ‡ßá‡¶á‡¶≤: aminul@example.com</p>
                    </div>
                    <div class="detail-item">
                        <h3>üìç ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®</h3>
                        <p id="profileLocation">‡¶¢‡¶æ‡¶ï‡¶æ, ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feedback Tab -->
        <div id="feedback" class="tab-content">
            <div class="card">
                <h2 class="card-title">üí¨ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø/‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</h2>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨, ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§ ‡¶¨‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ö‡¶æ‡¶ï‡ßÅ‡¶∞‡ßÄ‡¶∞ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®‡•§ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø Firebase ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡¶¨‡ßá‡•§
                </p>
                
                <div class="form-group">
                    <label for="offerName">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="offerName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ" required>
                </div>
                
                <div class="form-group">
                    <label for="offerEmail">‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® *</label>
                    <input type="text" id="offerEmail" placeholder="‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" required>
                </div>
                
                <div class="form-group">
                    <label for="offerType">‡¶ß‡¶∞‡¶® *</label>
                    <select id="offerType" required>
                        <option value="">‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option value="job_offer">‡¶ö‡¶æ‡¶ï‡ßÅ‡¶∞‡ßÄ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨</option>
                        <option value="feedback">‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§/‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂</option>
                        <option value="collaboration">‡¶∏‡¶π‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ</option>
                        <option value="other">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="offerMessage">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ *</label>
                    <textarea id="offerMessage" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨ ‡¶¨‡¶æ ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." required></textarea>
                </div>
                
                <button class="btn btn-block" id="submitOffer">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>
        </div>

        <!-- Payments Tab -->
        <div id="payments" class="tab-content">
            <div class="card">
                <h2 class="card-title">üí∞ ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶™‡¶æ‡¶ì‡¶®‡¶æ ‡¶ì ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç</h2>
                
                <div class="dashboard-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon">üíµ</div>
                        <div class="stat-value" id="totalDue">0</div>
                        <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="totalPaid">0</div>
                        <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-value" id="lastPayment">---</div>
                        <div class="stat-label">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    </div>
                </div>

                <div id="paymentsTableContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div class="notification" id="notification"></div>
    </div>

    <footer>
        <div class="container">
            <p class="footer-text">¬© 2023 Amar Kajer Hisab by OP Aminul FF | Firebase Realtime Database | ‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á</p>
            <p class="footer-text">‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞: OP Aminul FF | ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: <span id="currentDate"></span></p>
        </div>
    </footer>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDS8KyPDA0Kv3B9rm_et2AleRcqJ7JFSds",
            authDomain: "card-5274c.firebaseapp.com",
            databaseURL: "https://card-5274c-default-rtdb.firebaseio.com",
            projectId: "card-5274c",
            storageBucket: "card-5274c.appspot.com",
            messagingSenderId: "1036731069661",
            appId: "1:1036731069661:web:aminul-ff-app"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // App State
        let appState = {
            entries: {},
            profile: {},
            payments: {},
            offers: [],
            feedbacks: [],
            last7Days: [],
            allEntries: [],
            filteredEntries: [],
            products: [
                { id: 'panjabi', name: 'Panjabi', rate: 7 },
                { id: 'shirt', name: 'Shirt', rate: 5 },
                { id: 'panjabi_34_38', name: '34-38 Panjabi', rate: 5 },
                { id: 'panjabi_20_30', name: '20-30 Panjabi', rate: 3.50 },
                { id: 'panjabi_14_18', name: '14-18 Panjabi', rate: 3 },
                { id: 'drawjar', name: 'Drawjar', rate: 3 }
            ],
            darkMode: false,
            lastDayPieces: 0,
            liveProgress: 0,
            liveProgressInterval: null
        };

        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const currentDateEl = document.getElementById('currentDate');
        const notification = document.getElementById('notification');

        // Initialize Date
        const today = new Date();
        currentDateEl.textContent = today.toLocaleDateString('bn-BD', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
        });

        // Firebase Data Loaders
        function initApp() {
            showLoading('dashboard');
            showLoading('last7days');
            showLoading('fullHistory');
            showLoading('payments');
            
            // Load entries
            database.ref('/entries').orderByKey().on('value', (snapshot) => {
                const data = snapshot.val() || {};
                appState.entries = data;
                appState.allEntries = Object.entries(data).map(([date, entry]) => ({ date, ...entry }));
                appState.filteredEntries = [...appState.allEntries];
                
                calculateTotals();
                updateDashboard();
                updateLast7Days();
                updateFullHistory();
                updateProductsTable();
                calculateLast7Days();
                hideLoading('dashboard');
                hideLoading('fullHistory');
                
                // Start live progress
                startLiveProgress();
            }, (error) => {
                console.error('Error loading entries:', error);
                showNotification('‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading('dashboard');
                hideLoading('fullHistory');
            });

            // Load profile
            database.ref('/profile').on('value', (snapshot) => {
                const data = snapshot.val() || {};
                appState.profile = data;
                updateProfile();
            });

            // Load payments
            database.ref('/payments').on('value', (snapshot) => {
                const data = snapshot.val() || {};
                appState.payments = data;
                updatePayments();
                hideLoading('payments');
            });

            // Load last7days (if exists)
            database.ref('/last7days').on('value', (snapshot) => {
                const data = snapshot.val() || [];
                appState.last7Days = data;
                hideLoading('last7days');
            });

            // Load offers and feedbacks
            database.ref('/offers').on('value', (snapshot) => {
                const data = snapshot.val() || [];
                appState.offers = data;
            });

            database.ref('/feedbacks').on('value', (snapshot) => {
                const data = snapshot.val() || [];
                appState.feedbacks = data;
            });
        }

        // Calculate Totals
        function calculateTotals() {
            let totalAmount = 0;
            let totalPieces = 0;
            let daysCount = 0;
            
            Object.values(appState.entries).forEach(entry => {
                totalPieces += entry.totalPieces || 0;
                totalAmount += entry.totalAmount || 0;
                daysCount++;
            });
            
            appState.totalAmount = totalAmount;
            appState.totalPieces = totalPieces;
            appState.avgPerDay = daysCount > 0 ? Math.round(totalAmount / daysCount) : 0;
            
            // Calculate last day pieces for progress
            const dates = Object.keys(appState.entries).sort();
            if (dates.length > 0) {
                const lastDate = dates[dates.length - 1];
                appState.lastDayPieces = appState.entries[lastDate].totalPieces || 0;
            }
        }

        // Update Dashboard
        function updateDashboard() {
            // Update totals
            document.getElementById('totalAmount').textContent = `‡ß≥${appState.totalAmount.toLocaleString()}`;
            document.getElementById('totalPieces').textContent = appState.totalPieces.toLocaleString();
            document.getElementById('avgPerDay').textContent = `‡ß≥${appState.avgPerDay.toLocaleString()}`;
            
            // Update last update time
            const dates = Object.keys(appState.entries).sort();
            if (dates.length > 0) {
                const lastDate = dates[dates.length - 1];
                document.getElementById('lastUpdate').textContent = formatDate(lastDate);
            }
            
            // Update last day pieces
            document.getElementById('lastDayPieces').textContent = appState.lastDayPieces;
            document.getElementById('lastDayTotal').textContent = appState.lastDayPieces;
            
            // Calculate average per hour (assuming 12 hour work day)
            const avgPerHour = appState.lastDayPieces > 0 ? (appState.lastDayPieces / 12).toFixed(1) : 0;
            document.getElementById('avgPerHour').textContent = avgPerHour;
        }

        // Update Products Table
        function updateProductsTable() {
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = '';
            
            let totalPiecesAll = 0;
            let totalAmountAll = 0;
            
            appState.products.forEach(product => {
                let productPieces = 0;
                let productAmount = 0;
                
                // Calculate totals for this product
                Object.values(appState.entries).forEach(entry => {
                    if (entry[product.id]) {
                        productPieces += entry[product.id];
                        productAmount += entry[product.id] * product.rate;
                    }
                });
                
                totalPiecesAll += productPieces;
                totalAmountAll += productAmount;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>‡ß≥${product.rate}</td>
                    <td>${productPieces.toLocaleString()}</td>
                    <td>‡ß≥${productAmount.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Add total row
            const totalRow = document.createElement('tr');
            totalRow.style.fontWeight = 'bold';
            totalRow.style.backgroundColor = 'rgba(79, 70, 229, 0.1)';
            totalRow.innerHTML = `
                <td>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü</td>
                <td>-</td>
                <td>${totalPiecesAll.toLocaleString()}</td>
                <td>‡ß≥${totalAmountAll.toLocaleString()}</td>
            `;
            tbody.appendChild(totalRow);
        }

        // Update Last 7 Days
        function updateLast7Days() {
            const container = document.getElementById('last7daysTableContainer');
            
            const last7DaysData = getLast7DaysData();
            
            if (last7DaysData.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</p>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            ${appState.products.map(p => `<th>${p.name}</th>`).join('')}
                            <th>‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</th>
                            <th>‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            last7DaysData.forEach(day => {
                html += `
                    <tr>
                        <td>${formatDate(day.date)}</td>
                        ${appState.products.map(p => `<td>${day[p.id] || 0}</td>`).join('')}
                        <td><strong>${day.totalPieces || 0}</strong></td>
                        <td><strong>‡ß≥${(day.totalAmount || 0).toLocaleString()}</strong></td>
                    </tr>
                `;
            });
            
            // Add totals row
            const totals = calculatePeriodTotals(last7DaysData);
            html += `
                    <tr style="font-weight: bold; background-color: rgba(79, 70, 229, 0.1);">
                        <td>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü (‡ß≠ ‡¶¶‡¶ø‡¶®)</td>
                        ${appState.products.map(p => `<td>${totals.products[p.id] || 0}</td>`).join('')}
                        <td>${totals.totalPieces}</td>
                        <td>‡ß≥${totals.totalAmount.toLocaleString()}</td>
                    </tr>
                </tbody>
            </table>
            `;
            
            container.innerHTML = html;
        }

        // Update Full History
        function updateFullHistory() {
            const container = document.getElementById('fullHistoryTableContainer');
            
            if (appState.filteredEntries.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</p>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            ${appState.products.map(p => `<th>${p.name}</th>`).join('')}
                            <th>‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏</th>
                            <th>‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            appState.filteredEntries.forEach(entry => {
                html += `
                    <tr>
                        <td>${formatDate(entry.date)}</td>
                        ${appState.products.map(p => `<td>${entry[p.id] || 0}</td>`).join('')}
                        <td><strong>${entry.totalPieces || 0}</strong></td>
                        <td><strong>‡ß≥${(entry.totalAmount || 0).toLocaleString()}</strong></td>
                    </tr>
                `;
            });
            
            // Add totals row
            const totals = calculatePeriodTotals(appState.filteredEntries);
            html += `
                    <tr style="font-weight: bold; background-color: rgba(79, 70, 229, 0.1);">
                        <td>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü (${appState.filteredEntries.length} ‡¶¶‡¶ø‡¶®)</td>
                        ${appState.products.map(p => `<td>${totals.products[p.id] || 0}</td>`).join('')}
                        <td>${totals.totalPieces}</td>
                        <td>‡ß≥${totals.totalAmount.toLocaleString()}</td>
                    </tr>
                </tbody>
            </table>
            `;
            
            container.innerHTML = html;
        }

        // Update Profile
        function updateProfile() {
            const profile = appState.profile;
            
            if (profile.name) {
                document.getElementById('profileName').textContent = profile.name;
            }
            
            if (profile.photoBase64) {
                document.getElementById('profileImage').src = profile.photoBase64;
            }
            
            if (profile.skills) {
                document.getElementById('profileSkills').textContent = profile.skills;
            }
            
            if (profile.currentCompany) {
                document.getElementById('profileCurrentCompany').textContent = `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®: ${profile.currentCompany}`;
            }
            
            if (profile.agreementDays) {
                document.getElementById('agreementDays').textContent = profile.agreementDays;
            }
            
            if (profile.contact) {
                document.getElementById('profileContact').textContent = profile.contact;
            }
            
            if (profile.location) {
                document.getElementById('profileLocation').textContent = profile.location;
            }
        }

        // Update Payments
        function updatePayments() {
            const payments = appState.payments;
            let totalDue = 0;
            let totalPaid = 0;
            let lastPaymentDate = '---';
            let paymentsArray = [];
            
            if (payments && typeof payments === 'object') {
                paymentsArray = Object.values(payments);
                
                paymentsArray.forEach(payment => {
                    if (payment.type === 'due') {
                        totalDue += payment.amount || 0;
                    } else if (payment.type === 'paid') {
                        totalPaid += payment.amount || 0;
                    }
                    
                    if (payment.date && (!lastPaymentDate || payment.date > lastPaymentDate)) {
                        lastPaymentDate = payment.date;
                    }
                });
            }
            
            // Update UI
            document.getElementById('totalDue').textContent = `‡ß≥${totalDue.toLocaleString()}`;
            document.getElementById('totalPaid').textContent = `‡ß≥${totalPaid.toLocaleString()}`;
            document.getElementById('lastPayment').textContent = lastPaymentDate !== '---' ? formatDate(lastPaymentDate) : lastPaymentDate;
            
            // Update payments table
            const container = document.getElementById('paymentsTableContainer');
            
            if (paymentsArray.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">‡¶ï‡ßã‡¶® ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</p>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            <th>‡¶ß‡¶∞‡¶®</th>
                            <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                            <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                            <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            paymentsArray.sort((a, b) => (b.date || '').localeCompare(a.date || '')).forEach(payment => {
                const typeText = payment.type === 'paid' ? '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß' : '‡¶¨‡¶æ‡¶ï‡¶ø';
                const statusClass = payment.type === 'paid' ? 'success' : 'warning';
                const statusText = payment.type === 'paid' ? '‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®' : '‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ';
                
                html += `
                    <tr>
                        <td>${formatDate(payment.date)}</td>
                        <td>${typeText}</td>
                        <td>${payment.description || 'N/A'}</td>
                        <td>‡ß≥${(payment.amount || 0).toLocaleString()}</td>
                        <td><span style="padding: 5px 10px; background-color: ${statusClass === 'success' ? '#10b981' : '#f59e0b'}; color: white; border-radius: 20px; font-size: 0.8rem;">${statusText}</span></td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            container.innerHTML = html;
        }

        // Start Live Progress
        function startLiveProgress() {
            if (appState.liveProgressInterval) {
                clearInterval(appState.liveProgressInterval);
            }
            
            // Calculate progress based on time of day (simulating work progress)
            const now = new Date();
            const startOfWork = new Date();
            startOfWork.setHours(8, 0, 0, 0); // Start at 8 AM
            const endOfWork = new Date();
            endOfWork.setHours(20, 0, 0, 0); // End at 8 PM (12 hours)
            
            let progress = 0;
            
            if (now >= startOfWork && now <= endOfWork) {
                const totalWorkTime = endOfWork - startOfWork;
                const elapsedTime = now - startOfWork;
                progress = Math.min(100, (elapsedTime / totalWorkTime) * 100);
            } else if (now > endOfWork) {
                progress = 100;
            }
            
            // Calculate pieces based on progress
            const currentPieces = Math.round(appState.lastDayPieces * (progress / 100));
            
            // Update UI
            document.getElementById('liveProgressBar').style.width = `${progress}%`;
            document.getElementById('liveCounter').textContent = currentPieces.toLocaleString();
            appState.liveProgress = currentPieces;
            
            // Update every minute
            appState.liveProgressInterval = setInterval(() => {
                const now = new Date();
                
                if (now >= startOfWork && now <= endOfWork) {
                    const totalWorkTime = endOfWork - startOfWork;
                    const elapsedTime = now - startOfWork;
                    progress = Math.min(100, (elapsedTime / totalWorkTime) * 100);
                } else if (now > endOfWork) {
                    progress = 100;
                }
                
                const currentPieces = Math.round(appState.lastDayPieces * (progress / 100));
                document.getElementById('liveProgressBar').style.width = `${progress}%`;
                document.getElementById('liveCounter').textContent = currentPieces.toLocaleString();
                appState.liveProgress = currentPieces;
            }, 60000); // Update every minute
        }

        // Helper Functions
        function getLast7DaysData() {
            const dates = Object.keys(appState.entries).sort();
            const last7Dates = dates.slice(-7);
            return last7Dates.map(date => ({ date, ...appState.entries[date] }));
        }

        function calculateLast7Days() {
            const last7DaysData = getLast7DaysData();
            database.ref('/last7days').set(last7DaysData);
        }

        function calculatePeriodTotals(entries) {
            const totals = {
                totalPieces: 0,
                totalAmount: 0,
                products: {}
            };
            
            // Initialize product totals
            appState.products.forEach(p => {
                totals.products[p.id] = 0;
            });
            
            // Calculate totals
            entries.forEach(entry => {
                totals.totalPieces += entry.totalPieces || 0;
                totals.totalAmount += entry.totalAmount || 0;
                
                appState.products.forEach(p => {
                    totals.products[p.id] += entry[p.id] || 0;
                });
            });
            
            return totals;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('bn-BD', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function showLoading(tabId) {
            // Loading indicators are already in the HTML
        }

        function hideLoading(tabId) {
            const container = document.getElementById(`${tabId}TableContainer`);
            if (container) {
                const loadingEl = container.querySelector('.loading');
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }
            }
        }

        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Event Listeners
        function setupEventListeners() {
            // Theme Toggle
            themeToggle.addEventListener('click', () => {
                appState.darkMode = !appState.darkMode;
                document.body.classList.toggle('dark-mode', appState.darkMode);
                themeToggle.textContent = appState.darkMode ? '‚òÄÔ∏è' : 'üåô';
            });

            // Tab Navigation
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Filter for Full History
            document.getElementById('applyFilter').addEventListener('click', () => {
                const fromDate = document.getElementById('fromDate').value;
                const toDate = document.getElementById('toDate').value;
                
                if (!fromDate || !toDate) {
                    showNotification('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                    return;
                }
                
                if (fromDate > toDate) {
                    showNotification('‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡ßá‡¶∞ ‡¶™‡¶∞‡ßá ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶®‡¶æ', 'error');
                    return;
                }
                
                appState.filteredEntries = appState.allEntries.filter(entry => {
                    return entry.date >= fromDate && entry.date <= toDate;
                });
                
                updateFullHistory();
                showNotification(`‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${appState.filteredEntries.length} ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ`);
            });

            // Reset Filter
            document.getElementById('resetFilter').addEventListener('click', () => {
                document.getElementById('fromDate').value = '';
                document.getElementById('toDate').value = '';
                appState.filteredEntries = [...appState.allEntries];
                updateFullHistory();
                showNotification('‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
            });

            // Download CSV
            document.getElementById('downloadCSV').addEventListener('click', () => {
                downloadCSV();
            });

            // Submit Offer/Feedback
            document.getElementById('submitOffer').addEventListener('click', () => {
                submitOffer();
            });
        }

        // Download CSV
        function downloadCSV() {
            const entries = appState.filteredEntries.length > 0 ? appState.filteredEntries : appState.allEntries;
            
            if (entries.length === 0) {
                showNotification('‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á', 'error');
                return;
            }
            
            // Create CSV header
            const headers = ['Date', ...appState.products.map(p => p.name), 'Total Pieces', 'Total Amount'];
            const csvRows = [headers.join(',')];
            
            // Add data rows
            entries.forEach(entry => {
                const row = [
                    entry.date,
                    ...appState.products.map(p => entry[p.id] || 0),
                    entry.totalPieces || 0,
                    entry.totalAmount || 0
                ];
                csvRows.push(row.join(','));
            });
            
            // Add totals row
            const totals = calculatePeriodTotals(entries);
            const totalsRow = [
                'TOTAL',
                ...appState.products.map(p => totals.products[p.id] || 0),
                totals.totalPieces,
                totals.totalAmount
            ];
            csvRows.push(totalsRow.join(','));
            
            // Create CSV string
            const csvString = csvRows.join('\n');
            
            // Create and download file
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `amar-kajer-hisab-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
        }

        // Submit Offer/Feedback
        function submitOffer() {
            const name = document.getElementById('offerName').value.trim();
            const email = document.getElementById('offerEmail').value.trim();
            const type = document.getElementById('offerType').value;
            const message = document.getElementById('offerMessage').value.trim();
            
            // Validation
            if (!name || !email || !type || !message) {
                showNotification('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            // Create offer object
            const offer = {
                name,
                email,
                type,
                message,
                timestamp: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0]
            };
            
            // Save to Firebase
            const newOfferRef = database.ref('/offers').push();
            newOfferRef.set(offer)
                .then(() => {
                    showNotification('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶');
                    
                    // Clear form
                    document.getElementById('offerName').value = '';
                    document.getElementById('offerEmail').value = '';
                    document.getElementById('offerType').value = '';
                    document.getElementById('offerMessage').value = '';
                })
                .catch((error) => {
                    console.error('Error submitting offer:', error);
                    showNotification('‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨ ‡¶ú‡¶Æ‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                });
        }
    </script>
</body>
</html>