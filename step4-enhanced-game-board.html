<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OP Aminul FF Ludo - Play Online Ludo Game</title>
    <meta name="description" content="Play OP Aminul FF Ludo, a decentralized P2P online Ludo game inspired by Ludo King. Create or join rooms with 2-4 players using WebRTC. Free, no server required.">
    <meta name="keywords" content="op ludo, op ludo aminul ff, op aminul ff ludo, online ludo, p2p ludo, webrtc ludo, ludo king style">
    <!-- Open Graph Tags -->
    <meta property="og:title" content="OP Aminul FF Ludo - Decentralized Online Ludo Game">
    <meta property="og:description" content="Join the fun with OP Aminul FF Ludo! Play with friends in real-time using P2P technology. No backend needed.">
    <meta property="og:image" content="https://png.pngtree.com/png-clipart/20230401/ourmid/pngtree-ludo-board-game-png-image_6682444.png">
    <meta property="og:url" content="https://your-site-url.com">
    <meta property="og:type" content="game">
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="OP Aminul FF Ludo - Play Now!">
    <meta name="twitter:description" content="Experience Ludo King style gameplay in a P2P online Ludo game by OP Aminul FF.">
    <meta name="twitter:image" content="https://png.pngtree.com/png-clipart/20230401/ourmid/pngtree-ludo-board-game-png-image_6682444.png">
    <!-- Schema.org Game Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Game",
      "name": "OP Aminul FF Ludo",
      "description": "A decentralized P2P Ludo game inspired by Ludo King, built with HTML, CSS, and JS.",
      "genre": "Board Game",
      "numberOfPlayers": {
        "@type": "QuantitativeValue",
        "minValue": 2,
        "maxValue": 4
      },
      "url": "https://your-site-url.com"
    }
    </script>
    <!-- QRCode.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- canvas-confetti CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <!-- Emoji Picker CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@latest/dist/index.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #ff7e5f, #feb47b);
            min-height: 100vh;
            color: white;
            text-align: center;
        }
        .section {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .active {
            display: block;
        }
        h1, h2 {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .button {
            display: inline-block;
            padding: 12px 24px;
            font-size: 1.3em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            color: white;
            margin: 10px;
        }
        .button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        #create-btn { background: #4CAF50; }
        #join-btn { background: #2196F3; }
        #player-count-select, input[type="text"], select {
            padding: 12px;
            font-size: 1.2em;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin: 10px;
            width: 80%;
            max-width: 400px;
        }
        #game-board-section {
            position: relative;
            width: 90vmin;
            height: 90vmin;
            max-width: 800px;
            max-height: 800px;
            margin: 20px auto;
            background: url('https://www.publicdomainpictures.net/pictures/70000/velka/ludo-board.jpg') center/cover no-repeat;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        .piece {
            position: absolute;
            width: 5vmin;
            height: 5vmin;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.8s ease-in-out;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            background-size: cover;
            background-position: center;
            z-index: 10;
        }
        /* Using placeholder pawn images - find better transparent PNGs if possible */
        .red    { background-image: url('https://img.freepik.com/free-vector/red-circle-with-white-number-1_1053-123.jpg?w=740'); }
        .blue   { background-image: url('https://img.freepik.com/free-vector/blue-circle-with-white-number-1_1053-124.jpg?w=740'); }
        .green  { background-image: url('https://img.freepik.com/free-vector/green-circle-with-white-number-1_1053-125.jpg?w=740'); }
        .yellow { background-image: url('https://img.freepik.com/free-vector/yellow-circle-with-white-number-1_1053-126.jpg?w=740'); }
        #dice {
            width: 120px;
            height: 120px;
            background: #fff url('https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Two_red_dice_01.svg/120px-Two_red_dice_01.svg.png') center/cover;
            border-radius: 15px;
            margin: 20px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            cursor: pointer;
            font-size: 4em;
            line-height: 120px;
            color: black;
        }
        #current-turn {
            font-size: 1.8em;
            margin: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
        }
        #chat-box {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 320px;
            height: 240px;
            background: rgba(255,255,255,0.95);
            border-radius: 10px;
            overflow: hidden;
            color: black;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            z-index: 100;
        }
        #chat-messages {
            height: 190px;
            overflow-y: auto;
            padding: 10px;
            font-size: 0.9em;
        }
        #chat-input-container {
            display: flex;
            border-top: 1px solid #ddd;
        }
        #chat-input {
            flex: 1;
            padding: 8px;
            border: none;
        }
        #emoji-btn {
            padding: 8px 12px;
            background: #eee;
            border: none;
            cursor: pointer;
        }
        .loading {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #ad-placeholder {
            margin: 20px auto;
            width: 728px;
            height: 90px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }
        @media (max-width: 768px) {
            #game-board-section { width: 95vw; height: 95vw; }
            .piece { width: 6vw; height: 6vw; }
            #dice { width: 100px; height: 100px; font-size: 3em; line-height: 100px; }
            #chat-box { width: 90%; right: 5%; }
        }
    </style>
</head>
<body>

    <!-- Previous sections kept: landing, create-room, join-room -->
    <div id="landing" class="section active">
        <h1>OP Aminul FF Ludo</h1>
        <input type="text" id="name-input" placeholder="Enter your name">
        <button id="create-btn" class="button">Create Room</button>
        <button id="join-btn" class="button">Join Room</button>
    </div>

    <div id="create-room" class="section">
        <h2>Create Room - OP Aminul FF</h2>
        <select id="player-count-select">
            <option value="2">2 Players</option>
            <option value="3">3 Players</option>
            <option value="4" selected>4 Players</option>
        </select>
        <button id="generate-offer" class="button" style="background:#FF9800;">Generate Room Code</button>
        <div id="offer-display" class="hidden">
            <p>Your Room Code (Share with friends):</p>
            <div id="offer-code" style="font-size:1.8em;background:rgba(0,0,0,0.3);padding:10px;border-radius:10px;word-break:break-all;"></div>
            <div id="qr-code" style="margin:20px auto;background:white;padding:10px;border-radius:10px;"></div>
            <p>Waiting for players to join...</p>
            <div class="loading"></div>
            <div id="lobby-status">Waiting for players... (1/X joined)</div>
        </div>
        <button id="back-to-landing-create" class="button" style="background:#f44336;">Back</button>
    </div>

    <div id="join-room" class="section">
        <h2>Join Room - OP Aminul FF</h2>
        <input type="text" id="join-code-input" placeholder="Paste Room Code here">
        <button id="join-room-btn" class="button" style="background:#4CAF50;">Join Room</button>
        <div id="join-status" class="hidden"><p>Joining room...</p><div class="loading"></div></div>
        <button id="back-to-landing-join" class="button" style="background:#f44336;">Back</button>
    </div>

    <!-- Game Board Section - Enhanced with basic path logic stub, dice sound stub, etc. -->
    <div id="game-board" class="section">
        <h2>OP Aminul FF Ludo - Game Room</h2>
        <div id="current-turn">Waiting...</div>
        <div id="dice">Roll ðŸŽ²</div>
        <div id="game-board-section">
            <!-- Pieces added via JS -->
        </div>
        <div id="game-log" style="margin:20px auto; width:90%; max-width:800px; background:rgba(0,0,0,0.4); padding:15px; border-radius:10px; max-height:150px; overflow-y:auto; text-align:left; font-size:0.95em;"></div>
        
        <!-- Chat Box with Emoji -->
        <div id="chat-box">
            <div id="chat-messages"></div>
            <div id="chat-input-container">
                <input type="text" id="chat-input" placeholder="Type message or select emoji...">
                <button id="emoji-btn">ðŸ˜Š</button>
            </div>
        </div>

        <!-- Ad Placeholder -->
        <div id="ad-placeholder">
            <!-- Paste AdSense / Adsterra code here -->
            Ad Space (728x90 Banner Placeholder)
        </div>

        <button id="back-to-lobby" class="button" style="background:#f44336;">Leave Game</button>
    </div>

    <script>
        // Global state - building on previous
        let playerName = localStorage.getItem('playerName') || '';
        let isHost = false;
        let maxPlayers = 4;
        let players = []; // {name, color, position: 0 (0-51 common path), home: [0,0,0,0]}
        let currentTurnIndex = 0;
        let gameStarted = false;
        let selectedPiece = null;
        let colors = ['red', 'blue', 'green', 'yellow'];
        let playerColorMap = {}; // name -> color index

        // Simple common path positions (approximate % for CSS positioning) - 52 steps
        // This is a stub - real Ludo has specific path, home stretch, safe zones
        const pathPositions = Array.from({length: 52}, (_, i) => {
            // Circular path approximation - adjust for real board coordinates later
            const angle = (i / 52) * Math.PI * 2;
            return {
                left: 50 + 40 * Math.cos(angle) + '%',
                top: 50 + 40 * Math.sin(angle) + '%'
            };
        });

        const sections = {
            landing: document.getElementById('landing'),
            createRoom: document.getElementById('create-room'),
            joinRoom: document.getElementById('join-room'),
            gameBoard: document.getElementById('game-board')
        };

        function switchSection(id) {
            Object.values(sections).forEach(s => s.classList.remove('active'));
            sections[id].classList.add('active');
        }

        // Name handling
        const nameInput = document.getElementById('name-input');
        nameInput.value = playerName;
        nameInput.addEventListener('change', () => {
            playerName = nameInput.value.trim();
            if (playerName) localStorage.setItem('playerName', playerName);
        });

        function checkName() {
            if (!playerName) {
                playerName = prompt('Please enter your name:')?.trim() || '';
                nameInput.value = playerName;
                localStorage.setItem('playerName', playerName);
            }
            return !!playerName;
        }

        // Create / Join logic (stub - no real P2P yet)
        document.getElementById('create-btn').onclick = () => { if (checkName()) switchSection('createRoom'); };
        document.getElementById('join-btn').onclick = () => { if (checkName()) switchSection('joinRoom'); };

        document.getElementById('generate-offer').onclick = () => {
            maxPlayers = parseInt(document.getElementById('player-count-select').value);
            const code = 'OPLUDO-' + Math.random().toString(36).substring(2,9).toUpperCase();
            document.getElementById('offer-code').textContent = code;
            document.getElementById('offer-display').classList.remove('hidden');
            new QRCode(document.getElementById("qr-code"), { text: code, width: 200, height: 200 });
            isHost = true;
            players = [{name: playerName, color: colors[0], index: 0, pieces: [0,0,0,0]}]; // position 0 = yard
            updateLobbyStatus();
        };

        function updateLobbyStatus() {
            document.getElementById('lobby-status').textContent = `Waiting for players... (\( {players.length}/ \){maxPlayers} joined)`;
        }

        document.getElementById('join-room-btn').onclick = () => {
            const code = document.getElementById('join-code-input').value.trim();
            if (code && checkName()) {
                document.getElementById('join-status').classList.remove('hidden');
                setTimeout(() => {
                    // Simulate join - in real: exchange SDP
                    alert(`Joined room ${code}! (P2P stub)`);
                    // Assign color based on join order
                    const color = colors[players.length % 4];
                    players.push({name: playerName, color, index: players.length, pieces: [0,0,0,0]});
                    startGame();
                }, 1500);
            }
        };

        // Back buttons
        document.querySelectorAll('[id^="back-to-landing"]').forEach(b => b.onclick = () => switchSection('landing'));

        // Start game
        function startGame() {
            switchSection('gameBoard');
            gameStarted = true;
            updateTurnDisplay();
            placePieces();
            logMessage('Game Started! ' + players[currentTurnIndex].name + "'s turn (" + players[currentTurnIndex].color.toUpperCase() + ")");
        }

        function updateTurnDisplay() {
            const p = players[currentTurnIndex];
            document.getElementById('current-turn').textContent = `\( {p.name}'s Turn ( \){p.color.toUpperCase()}) - Roll Dice!`;
        }

        function placePieces() {
            const board = document.getElementById('game-board-section');
            players.forEach((p, playerIdx) => {
                p.pieces.forEach((pos, pieceIdx) => {
                    const piece = document.createElement('div');
                    piece.className = `piece ${p.color}`;
                    piece.dataset.playerIdx = playerIdx;
                    piece.dataset.pieceIdx = pieceIdx;
                    // Yard positions - approximate corners
                    const offset = pieceIdx * 2 + playerIdx * 0.5;
                    piece.style.left = (playerIdx * 20 + offset) + '%';
                    piece.style.top = (playerIdx < 2 ? 5 : 80) + '%';
                    piece.onclick = () => handlePieceClick(playerIdx, pieceIdx);
                    board.appendChild(piece);
                });
            });
        }

        function handlePieceClick(playerIdx, pieceIdx) {
            if (playerIdx !== currentTurnIndex) return alert("Not your turn!");
            selectedPiece = {playerIdx, pieceIdx};
            logMessage(`${players[playerIdx].name} selected piece ${pieceIdx + 1}`);
            // In full impl: check if can move (6 for out, or any if out)
        }

        document.getElementById('dice').onclick = () => {
            if (!gameStarted || currentTurnIndex !== players.findIndex(p => p.name === playerName)) return;
            const roll = Math.floor(Math.random() * 6) + 1;
            document.getElementById('dice').textContent = roll;
            logMessage(`${players[currentTurnIndex].name} rolled ${roll}`);

            // Stub sound
            // const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-2163.mp3'); // find real dice roll
            // audio.play();

            if (selectedPiece) {
                // Move piece stub
                const p = players[selectedPiece.playerIdx];
                const pieceElem = document.querySelector(`.piece[data-player-idx="\( {selectedPiece.playerIdx}"][data-piece-idx=" \){selectedPiece.pieceIdx}"]`);
                if (p.pieces[selectedPiece.pieceIdx] === 0 && roll === 6) {
                    // Bring out
                    p.pieces[selectedPiece.pieceIdx] = 1;
                    const pos = pathPositions[0];
                    pieceElem.style.left = pos.left;
                    pieceElem.style.top = pos.top;
                    logMessage(`${p.color.toUpperCase()} piece out!`);
                } else if (p.pieces[selectedPiece.pieceIdx] > 0) {
                    p.pieces[selectedPiece.pieceIdx] += roll;
                    if (p.pieces[selectedPiece.pieceIdx] > 52) p.pieces[selectedPiece.pieceIdx] = 52; // stub home
                    const pos = pathPositions[p.pieces[selectedPiece.pieceIdx] - 1] || {left:'50%', top:'50%'};
                    pieceElem.style.left = pos.left;
                    pieceElem.style.top = pos.top;
                    logMessage(`Moved ${roll} steps`);
                    // Check kill, home etc later
                }
                selectedPiece = null;
            }

            // Next turn
            currentTurnIndex = (currentTurnIndex + 1) % players.length;
            updateTurnDisplay();
        };

        function logMessage(msg) {
            const log = document.getElementById('game-log');
            log.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // Chat with emoji
        const picker = new EmojiButton();
        picker.on('emoji', emoji => {
            document.getElementById('chat-input').value += emoji.emoji;
            document.getElementById('chat-input').focus();
        });
        document.getElementById('emoji-btn').onclick = () => picker.togglePicker(document.getElementById('emoji-btn'));

        const chatInput = document.getElementById('chat-input');
        chatInput.addEventListener('keypress', e => {
            if (e.key === 'Enter' && chatInput.value.trim()) {
                const msg = chatInput.value.trim();
                document.getElementById('chat-messages').innerHTML += `<p><strong>${playerName}:</strong> ${msg}</p>`;
                logMessage(`Chat: ${playerName}: ${msg}`);
                chatInput.value = '';
                document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
            }
        });

        // Confetti stub for winner
        function celebrateWin() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }
    </script>
</body>
</html>